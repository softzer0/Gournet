{% load tz %}{% get_current_timezone as TIME_ZONE %}<form ng-init="setD('deftz', '{{ TIME_ZONE }}')">{% csrf_token %}
    <uib-alert ng-if="refresh" type="warning">You have to refresh the page for changes to take effect.</uib-alert>
    <div class="form-group">
        <label class="control-label" for="language">Language:</label>
        <select class="form-control" ng-disabled="obj.saving" name="language" ng-model="user.language" ng-init="setD('language', '{{ request.user.language }}')">{% for l in langs %}
            <option value="{{ l.0 }}">{{ l.1 }}</option>{% endfor %}
        </select>
    </div>
    <div class="form-group">
        <label class="control-label" for="currency">Preferred currency:</label>
        <select class="form-control" ng-disabled="obj.saving" name="currency" ng-model="user.currency"{% comment %}ng-init="setD('currency', '{{ request.user.currency }}')"{% endcomment %}>{% for c in currencies %}
            <option value="{{ c.0 }}">{{ c.1 }}</option>{% endfor %}
        </select>
    </div>
    <div class="form-group">
        <label class="control-label" for="tz">Preferred time zone:</label>
        <select class="form-control" ng-disabled="obj.saving" name="tz" ng-model="user.tz" ng-init="setD('tz', '{{ request.user.tz.zone }}')">{% for tz in timezones %}
            <option value="{{ tz }}">{{ tz }}</option>{% endfor %}
        </select>
    </div>
    <p class="locp"><span>Current time zone: {% verbatim %}{{ user.deftz }}{% endverbatim %}</span><input class="btn btn-warning" type="button" ng-disabled="obj.saving" ng-click="user.tz = user.deftz" ng-hide="user.tz == user.deftz" value="Use"></p>
    <input class="btn btn-success" ng-disabled="obj.saving" type="submit" value="Save" ng-click="submitLocal()">
</form>