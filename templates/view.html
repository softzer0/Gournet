{% extends 'base/view.html' %}

{% block head %}{{ block.super }}
    {% comment %}<style>
        .remp {
            padding-bottom: 0;
        }
        .hrm {
            margin: 13px;
        }</style>{% endcomment %}{% load staticfiles %}<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js"></script>
    <script src="{% static 'main/js/custom/view.js' %}"></script>
    {% if fav_state == -1 %}<script src="{% static 'main/js/custom/manager.js' %}"></script>{% endif %}{% endblock %}

{% block bodyatt %}{{ block.super }} ng-init="id = {{ business.id }}"{% endblock %}

{% block rowatt %}ng-controller="BusinessCtrl" ng-init="fav_count = {{ fav_count }}; fav_state = {{ fav_state }}; minchar = {{ minchar }}; tz = '{{ business.tz }}'"{% endblock %}

{% block name_content %}{% if business.manager == request.user %}<div class="inline namef br2" ng-cloak click-outside="co(0)" ng-init="{% load getextend %}{% for n in edit_data %}{{ n }} = [{% for t in edit_data|get_item:n %}'{% if t.1|length|get_digit:'-1' > 1 %}{{ t.1 }}{% else %}{{ t }}{% endif %}'{% if not forloop.last %}, {% endif %}{% endfor %}]; {% endfor %}setE({{ business.type }}, '{{ business.name }}', '{{ business.shortname }}')">
                        <a class="n lead text-center" ng-show="edit[0].disabled" ng-click="edit[0].disabled = false">{% verbatim %}{{ types[edit[0].value[0]] }} "{{ edit[0].value[1] }}"{% endverbatim %}</a>
                        <div ng-hide="edit[0].disabled">
                            <div>
                                <div>
                                    <div class="ulh"><ul class="nya-bs-select" ng-model="edit[0].form[0]">
                                        <li nya-bs-option="t in types" data-value="$index"><a>{% verbatim %}{{ t }}{% endverbatim %}</a></li>
                                    </ul><div ng-show="edit[0].disabled == null"></div></div>
                                    <div><input type="text" class="form-control" ng-disabled="edit[0].disabled == null" ng-model="edit[0].form[1]"></div>
                                </div>
                            </div>
                            <div>
                                <div>
                                    <label for="shortname">Shortname:</label>
                                    <div><input name="shortname" type="text" pattern="^[\w.-]+$" class="form-control" ng-disabled="edit[0].disabled == null" ng-model="edit[0].form[2]"></div>
                                </div>
                            </div>
                            <a class="fa fa-2x fa-check n text-center" ng-click="doAction()"></a>
                        </div>
                    </div>{% else %}<p class="br2 lead text-center ww">{% block name %}{{ business.get_type_display }} "{{ business.name }}"{% endblock %}</p>{% endif %}{% endblock %}

{% block img %}{{ business.pk }}/avatar/?business=1{% endblock %}

{% block other %}<li{% if business.manager != request.user %} ng-init="rating = {value: {{ rating.0 }}, count: {{ rating.1 }}, user: {{ rating.2 }}}"><span star-rating="rating.value" user-number="rating.count" user-rating="rating.user" show-stats="true" readonly="true"{% else %}><span star-rating="{{ rating.0 }}"{% if rating.1 > 0 %} user-number="{{ rating.1 }}" user-rating="-1"{% endif %}{% endif %}></span></li>
                        <li
                            ><span ng-if="fav_count > 0"
                                ><a href="javascript:" ng-click="showFavouritesModal()"
                                    ><i class="fa fa-heart"></i> <strong>{% verbatim %}{{ fav_count }}{% endverbatim %}</strong
                                ></a> {% verbatim %}{{ fav_count > 1 ? "osobe su favorizovale" : "osoba je favorizovala" }}{% endverbatim %} ovo</span
                            ><span ng-if="fav_count == 0"
                                ><i class="fa fa-heart"></i> Niko nije favorizovao ovo</span
                        ></li>
                        {% if fav_state > -1 %}<li
                            ><a href="javascript:" {% comment %}ng-dialog-message="{% verbatim %}{{ fav_state_msg }}{% endverbatim %}" {% endcomment %}ng{% comment %}-dialog{% endcomment %}-click="doFavouriteAction()"
                                ><span ng-if="fav_state == 0"
                                    ><i class="fa fa-plus-square"></i> {% verbatim %}{{ fav_count > 0 ? "I meni je omiljeno" : "Meni je omiljeno" }}{% endverbatim %}</span
                                ><span ng-if="fav_state == 1"
                                    ><i class="fa fa-minus-square"></i> Nije mi više omiljeno</span
                            ></a
                        ></li>
                        {% comment %}<li><a href="javascript:"><i class="fa fa-ticket"></i> Rezervisanje mesta</a></li>{% endcomment %}
                        {% endif %}<li>
                            <hr style="margin: 8px 13px 13px;">
                            <ul class="list-unstyled">
                                <li><b ng-class="is_opened ? 'text-success' : 'text-danger'">{% verbatim %}{{ is_opened ? 'Trenutno otvoreno' : 'Trenutno zatvoreno' }}{% endverbatim %}</b></li>
                                <li><i class="fa fa-sign-in"></i> Radnim danima od 8h do 20h</li>
                                <li><i class="fa fa-sign-in"></i> Subotom od 8h do 15h</li>
                            </ul>
                        </li>
                        <li><ul class="list-unstyled">
                                <li><a href="https://maps.google.com/maps?q=Vojvode Mišića 79, Niš"><i class="fa fa-map-marker"></i> Vojvode Mišića 79, Niš</a></li>
                                <li><i class="fa fa-phone"></i> +381 18/756-235</li>
                            </ul>
                        </li>
                        <li><ul class="list-unstyled">
                                <li><a href="https://maps.google.com/maps?q=Kraljevića Marka 34, Vranje"><i class="fa fa-map-marker"></i> Kraljevića Marka 34, Vranje</a></li>
                                <li><i class="fa fa-phone"></i> +381 64/22-59-137</li>
                            </ul>
                        </li>{% endblock %}

{% block content %}{% if not business.is_published %}                    <uib-alert id="unpub" type="warning">Your business won't be visible to others until you add some items to it.</uib-alert>

                    {% endif %}<uib-tab index="0" heading="Events">
{% if fav_state == -1 %}						<div class="well bs-component clearfix wp" ng-controller="EventCtrl">
							<form name="forms.event" ng-submit="submitEvent()" class="frm form-vertical">
                                <uib-alert class="mpd" type="danger" close="forms.event.alert = false" ng-if="forms.event.alert">Please enter a message with {{ minchar }} or more characters.</uib-alert>
                                <div class="form-group" ng-class="{'has-error': forms.event.alert}">
								    <textarea name="text" class="form-control" rows="3" required></textarea>
                                </div>
                                <p class="input-group" style="width: 250px;">
                                    <input type="hidden" datetime-picker="dd.MM.yyyy HH:mm" datepicker-options="picker.options" ng-model="picker.date" is-open="picker.open">
                                    <input type="text" class="form-control" datetime="dd.MM.yyyy HH:mm" ng-model="picker.date" min="{% verbatim %}{{ picker.options.minDate.toUTCString() }}{% endverbatim %}">
                                    <span class="input-group-btn">
                                        <button type="button" class="btn btn-default" ng-click="picker.open = true"><i class="fa fa-calendar"></i></button>
                                    </span>
                                </p>
								<input type="submit" class="btn btn-primary" value="Submit">
							</form>
						</div>

{% endif %}                        <div class="mn1 vi" ng-init="t = 'event'" ng-if="objloaded[0] || active == 0" ng-include="'/static/main/events.html'"></div>
                    </uib-tab>

                    <uib-tab index="1" heading="Menu">
{% if fav_state == -1 %}						<div class="well bs-component clearfix wp" ng-controller="ItemCtrl">
							<form name="forms.item" ng-submit="submitItem()" class="frm form-vertical">
                                <uib-alert class="mpd" type="danger" close="forms.item.alert = undefined" ng-if="forms.item.alert !== undefined">Please enter a valid name (it {% verbatim %}{{ forms.item.alert === true ? "must have minimum 2 characters" : "conflicts with the existing item" }}{% endverbatim %}).</uib-alert>
                                <div class="form-group" ng-class="{'has-error': forms.item.alert !== undefined}">
                                    <input name="name" type="text" class="form-control" required>
                                </div>
                                <div class="input-group">
                                    <input type="number" name="price" step="0.01" min="0" class="form-control" required>
                                    <span class="input-group-addon">{{ business.currency }}</span>
                                </div>
                                {% load bootstrap3 %}{% bootstrap_field form.cat %}
								<input type="submit" class="btn btn-primary" value="Submit">
							</form>
						</div>

{% endif %}                        <div class="mn">
                            <div class="angular-animate" ng-if="objloaded[1] && c.hascontent" ng-repeat="c in menu" ng-cloak>
                                <hr ng-if="!c.first">
                                <h4 ng-bind="c.name"></h4>
                                <div class="angular-animate" ng-repeat="sc in c.content" ng-if="sc.content.length > 0">
                                    <h5 class="text-center">{% verbatim %}{{ sc.name }}{% endverbatim %}</h5>
                                    <table class="table table-hover tb">
                                        {% comment %}<thead>
                                            <tr>
                                                <th>Ime proizvoda</th>
                                                <th>Cena</th>
                                            </tr>
                                            </thead>{% endcomment %}
                                        <tbody>
                                            <tr class="angular-animate clickable" ng-repeat="i in sc.content" ng-click="showItem(i.id)">
                                                <td>
                                                    {% if business.manager == request.user %}<div class="img_p">
                                                        {% endif %}<img class="bor" ng-src="/images/{% verbatim %}{{ i.id }}{% endverbatim %}/avatar/32/?item=1{% if business.manager == request.user %}{% verbatim %}{{ img[i.id].ts || '' }}{% endverbatim %}" ng-init="img[i.id].file = null" uib-tooltip="{% verbatim %}{{ drag_txt }}{% endverbatim %}" ngf-drop ngf-select ng-model="img[i.id].file" ng-disabled="img[i.id].file" ng-class="{'clickable': !img[i.id].file}" accept="image/jpeg,image/png,image/gif" ngf-pattern="'image/jpeg,image/png,image/gif'"
                                                        ><div class="img_l" ng-show="img[i.id].file"><div class="loa loa-c"><i class="fa fa-spinner"></i></div></div
                                                    ></div{% else %}"{% endif %}
                                                    ><div>{% verbatim %}{{ i.name }}{% endverbatim %}</div>
                                                </td>
                                                <td><div>{% verbatim %}{{ (i.converted || i.price)|currency:'' }}{% endverbatim %} {% if business.currency != request.user.currency and request.user.currency in business.supported_curr %}{{ request.user.currency }}{% else %}{{ business.currency }}{% endif %}</div></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="mt5 mb13 loa loa-c" ng-if="active == 1 && !objloaded[1]"><i class="fa fa-spinner fa-2x"></i></div>
                        </div>
					</uib-tab>

                    <uib-tab index="2" heading="Reviews">
{% if fav_state != -1 %}						<div ng-if="showrevf" class="well bs-component clearfix wp">
							<form name="forms.review" ng-submit="submitReview()" class="frm form-vertical">
                                <uib-alert class="mpd" type="danger" close="forms.review.alert = 0" ng-if="forms.review.alert > 0">{% verbatim %}{{ forms.review.alert != 2 ? "Please enter a message with "+minchar+" or more characters." : '' }} {{ forms.review.alert != 1 ? "Please select how many stars you give." : '' }}{% endverbatim %}</uib-alert>
                                <div class="form-group" ng-class="{'has-error': forms.review.alert == 1 || forms.review.alert == 3}">
								    <textarea name="text" class="form-control" rows="3" required></textarea>
                                </div>
                                <div class="mpd" star-rating="forms.review_stars" user-rating="forms.review_stars"></div>
								<input type="submit" class="btn btn-primary" value="Submit">
							</form>
						</div>

{% endif %}                        <div class="mn1 vi" ng-init="t = 'review'" ng-if="objloaded[2] || active == 2" ng-include="'/static/main/events.html'"></div>
                    </uib-tab>{% endblock %}